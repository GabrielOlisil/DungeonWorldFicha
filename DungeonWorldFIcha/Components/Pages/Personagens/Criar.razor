@page "/Personagens/novo/{id:guid?}"
@using DungeonWorldFIcha.Models
@using DungeonWorldFIcha.Services
@inject PersonagemService PersonagemService
@inject NavigationManager Navigation

@rendermode InteractiveServer


<PageTitle>Personagem</PageTitle>

<h3 class="mb-4 text-center">Criar Personagem</h3>

<EditForm Model="@personagem" OnValidSubmit="HandleValidSubmit">
    <DataAnnotationsValidator/>

   

    <div class="container mt-4">
        <div class="d-flex justify-content-end">
            <button type="submit" class="btn btn-success mt-3 mb-5">Salvar Personagem</button>
        </div>

        <!-- Seção: Nome, Raça e Classe com Floating Labels -->
        <div class="row g-3 mb-3">
            <!-- Nome -->
            <div class="col-2">
                <div class="form-floating">
                    <InputText class="form-control" id="fieldName" placeholder="Nome"  @bind-Value="personagem.Nome"/>
                    <label for="fieldName" >Nome</label>
                </div>
            </div>

      

            <!-- Classe -->
            <div class="col-2">
                <div class="form-floating">
                    <InputText class="form-control" placeholder id="fieldClasse" @bind-Value="personagem.Classe"/>
                    <label for="fieldClasse" >Classe</label>
                </div>
            </div>
            <div class="col-2">
                <div class="form-floating">
                    <InputNumber class="form-control" placeholder id="fieldNivel" @bind-Value="personagem.Nivel"/>
                    <label for="fieldNivel" class="fs-5">Nível</label>
                </div>
            </div>

            <div class="col-6">
                <div class="input-group mb-1">
                    <span class="input-group-text bg-black text-white">PV</span>
                    <InputNumber class="form-control" @bind-Value="personagem.Pv" />
                    <span class="input-group-text bg-black text-white">ARM</span>
                    <InputNumber class="form-control" @bind-Value="personagem.Armadura" />
                    <span class="input-group-text bg-black text-white">DANO</span>
                    <InputNumber class="form-control" @bind-Value="personagem.DadoDano" />
                </div>
            </div>
        </div>


        <!-- Seção: Habilidades com Input Group -->
        <div class="mb-4 mt-3">
            <h5>Habilidades</h5>
           
        </div>

        <!-- Seção: Atributos e Equipamento lado a lado -->
        <div class="row">


            <div class="col-sm-3">
                    <div class="input-group mb-1">
                        <span class="input-group-text bg-black text-white">FOR</span>
                        <InputNumber class="form-control" @bind-Value="personagem.Habilidade.Forca" />
                    </div>
                    <div class="input-group mb-1">
                        <span class="input-group-text bg-black text-white">DES</span>
                        <InputNumber class="form-control" @bind-Value="personagem.Habilidade.Destreza" />
                    </div>
                    <div class="input-group mb-1">
                        <span class="input-group-text bg-black text-white">CAR</span>
                        <InputNumber class="form-control" @bind-Value="personagem.Habilidade.Carisma" />
                    </div>
                    <div class="input-group mb-1">
                        <span class="input-group-text bg-black text-white">CON</span>
                        <InputNumber class="form-control" @bind-Value="personagem.Habilidade.Constituicao" />
                    </div>
                    <div class="input-group mb-1">
                        <span class="input-group-text bg-black text-white">INT</span>
                        <InputNumber class="form-control" @bind-Value="personagem.Habilidade.Inteligencia" />
                    </div>
                    <div class="input-group mb-1">
                        <span class="input-group-text bg-black text-white">SAB</span>
                        <InputNumber class="form-control" @bind-Value="personagem.Habilidade.Sabedoria" />
                    </div>
            </div>
            <div class="col-sm-9">
                <h5 class="bg-dark text-white p-1">Equipamento</h5>
                <InputTextArea class="form-control-plaintext p-1" placeholder="Digite aqui" style="height: 15rem; box-shadow: none"  @bind-Value="personagem.Equipamento"/>
            </div>
        </div>

        <!-- Seção: Aparência e Vínculos -->

        <h5 class="bg-dark text-white p-1 mt-4">Informacoes</h5>

        <!-- Seção: Movimentos -->
        <div class="mb-4">
            <div class="row g-3">
                <div class="col-md-6">
                    <InputTextArea class="form-control-plaintext" placeholder="Digite aqui" style="height: 20rem" @bind-Value="personagem.DescricaoUm"/>
                </div>
                <div class="col-md-6">
                    <InputTextArea class="form-control-plaintext" placeholder="Digite aqui" style="height: 20rem" @bind-Value="personagem.DescricaoDois"/>
                </div>
            </div>
        </div>

        <!-- Botão de Submissão -->
       
    </div>
</EditForm>

@code {
    [Parameter] public Guid? Id { get; set; }

    private Personagem personagem = new() { Habilidade = new Habilidade() };

    protected override async Task OnInitializedAsync()
    {
        if (Id.HasValue)
        {
            personagem = await PersonagemService.GetPersonagemById(Id.Value);
        }
    }

    private async Task HandleValidSubmit()
    {
        if (Id.HasValue)
        {
            await PersonagemService.AtualizarPersonagem(personagem);
            Navigation.NavigateTo($"/personagens/{Id}");
            return;
        }
        
        await PersonagemService.AdicionarPersonagem(personagem);
        Navigation.NavigateTo("/personagens"); // Redireciona para a página inicial
    }
}